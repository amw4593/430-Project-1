<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Google Forms</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

  <style>
    body {
      background-color: #f5f5f5;
      font-family: 'Arial', sans-serif;
    }

    .hero.is-success {
      background-color: #23d160;
      color: #fff;
    }

    #content {
      margin-top: 20px;
    }

    .container {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
  </style>

<script>
  const handleResponse = async (response, parseResponse) => {
    const content = document.querySelector('#content');

    switch (response.status) {
      case 200:
        content.innerHTML = '<b>Success</b>';
        break;
      case 201:
        content.innerHTML = '<b>Created</b>';
        break;
      case 204:
        content.innerHTML = '<b>No Content</b>';
        break;
      case 400:
        content.innerHTML = `<b>Bad Request</b>`;
        break;
      case 404:
        content.innerHTML = '<b>Resource Not Found</b>';
        break;
      default:
        content.innerHTML = `Error code not implemented by client.`;
        break;
    }

    if (parseResponse && response.status !== 204) {
      const obj = await response.json();

      if (obj.users) {
        content.innerHTML += `<p>${JSON.stringify(obj.users)}</p>`;
      }

      if (obj.message) {
        content.innerHTML += `<p>Message: ${obj.message}</p>`;
      }

    } else {
      content.innerHTML += '<p>Meta Data Received</p>';
    }
  };

  const sendPost = async (form) => {
    const url = form.getAttribute('action');
    const name = form.querySelector('#nameField').value;
    const age = form.querySelector('#ageField').value;

    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'x-www-form-urlencoded'
      },
      body: `name=${name}&age=${age}`,
    });

    handleResponse(response, true);
  }

  const requestUpdate = async (userForm) => {
    const url = userForm.querySelector('#urlField').value;
    const method = userForm.querySelector('#methodSelect').value;

    try {
      let response = await fetch(url, {
        method,
        headers: {
          'Accept': 'application/json',
        },
      });

      handleResponse(response, method === 'get');
    } catch (error) {
      console.error('Error:', error);
    }
  };

  const init = () => {
    const userForm = document.querySelector('#userForm');
    const nameForm = document.querySelector('#nameForm');

    const addUser = (e) => {
      e.preventDefault();
      sendPost(nameForm);
      return false;
    }

    const getUsers = (e) => {
      e.preventDefault();
      requestUpdate(userForm);
      return false;
    }

    userForm.addEventListener('submit', getUsers);
    nameForm.addEventListener('submit', addUser);
  };

  window.onload = init;
</script>

</head>

<body>
  <section class="hero is-success">
    <div class="hero-body">
      <div class="container">
        <h1 class="title is-1">
          Hello World
        </h1>
        <p class="subtitle">
          A Computer Science Portal for Geeks
        </p>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <form id="nameForm" action="/addUser" method="post">
        <div class="field is-horizontal">
          <div class="field-label is-normal">
            <label class="label" for="name">Name:</label>
          </div>
          <div class="field-body">
            <div class="field">
              <p class="control">
                <input id="nameField" class="input" type="text" name="name" />
              </p>
            </div>
          </div>
        </div>

        <div class="field is-horizontal">
          <div class="field-label is-normal">
            <label class="label" for="age">Age:</label>
          </div>
          <div class="field-body">
            <div class="field">
              <p class="control">
                <input id="ageField" class="input" type="number" name="age" min="0" max="100" step="1" />
              </p>
            </div>
          </div>
        </div>

        <div class="field is-horizontal">
          <div class="field-label"></div>
          <div class="field-body">
            <div class="field">
              <p class="control">
                <input class="button is-success" type="submit" value="Add User" />
              </p>
            </div>
          </div>
        </div>
      </form>

      <form id="userForm" action="/getUsers" method="get">
        <div class="field is-horizontal">
          <div class="field-label is-normal">
            <label class="label" for="urlField">URL:</label>
          </div>
          <div class="field-body">
            <div class="field">
              <p class="control">
                <div class="select">
                  <select id="urlField">
                    <option value='/getUsers'>/getUsers</option>
                    <option value='/notReal'>/notReal</option>
                  </select>
                </div>
              </p>
            </div>
          </div>
        </div>

        <div class="field is-horizontal">
          <div class="field-label is-normal">
            <label class="label" for="methodSelect">Method:</label>
          </div>
          <div class="field-body">
            <div class="field">
              <p class="control">
                <div class="select">
                  <select id="methodSelect">
                    <option value="get">GET</option>
                    <option value="head">HEAD</option>
                  </select>
                </div>
              </p>
            </div>
          </div>
        </div>

        <div class="field is-horizontal">
          <div class="field-label"></div>
          <div class="field-body">
            <div class="field">
              <p class="control">
                <input class="button is-info" type="submit" value="Get User" />
              </p>
            </div>
          </div>
        </div>
      </form>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div id="content"></div>
    </div>
  </section>
</body>

</html>
